{# Random-Number #}
{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
    <h2 class="border-bottom py-2">잠깐! 숫자를 맞춰야 합니다.</h2>
    <p class="text-muted">1부터 10 사이의 랜덤 숫자를 맞춰보세요. 틀리면 쫓겨납니다!</p>

    <form action="{% url 'pybo:num_check' question_id %}" method="post" class="mt-4">
        {% csrf_token %}
        <div class="mb-3">
            <label for="user_input" class="form-label">정답 입력</label>
            <input type="number" name="user_input" id="user_input"
                   class="form-control" min="1" max="10" required>
        </div>
        <button type="submit" class="btn btn-primary">운명에 맡기기</button>
    </form>

    {# 디버그 용도 #}
    <div class="mt-5 p-3 border border-warning bg-light">
        <p class="text-danger"><strong>[디버깅 모드]</strong> 현재 세션에 저장된 정답: {{ debug_answer }}</p>
    </div>

    {# 숫자를 잘못 입력했을 경우 에러 메시지 #}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                <strong>앗!</strong> {{ message.message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
</div>
{% endblock %}

{# 숫자를 잘못 입력했을 경우 기능 #}
{# 에러 메세지, 입력창 비활성화, 3초 후 돌아가기 #}
{% block script %}
<script>
    // 1. 화면에 'alert-danger'(틀렸을 때 빨간 창) 있는지 체크
    const alertMessage = document.querySelector('.alert');

    if (alertMessage) {
        // 2. 입력창, 버튼 비활성화
        const inputField = document.querySelector('input[name="user_input"]');
        const submitBtn = document.querySelector('button[type="submit"]');

        if (inputField) inputField.disabled = true;
        if (submitBtn) submitBtn.disabled = true;

        // 3. 3초(3000ms) 뒤에 강제로 질문 목록 페이지로 이동
        setTimeout(function() {
            window.location.href = "{% url 'pybo:index' %}";
        }, 3000);
    }
</script>
{% endblock %}